<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="chat-messages.html">
<link rel="import" href="chat-input.html">

<!--
`chat-window`
A simple and flexible chat window for listing messages.

Style hooks:

* `--chat-window` Applied to the chat-window container.

* `--chat-window-messages` Applied to the chat-messages element.

* `--chat-window-input` Applied to the chat-input element.

@demo demo/index.html
-->

<dom-module id="chat-window">
  <template>
    <style>
      :host {
        display: block;
      }
      .container {
        @apply --chat-window;
      }
      chat-messages {
        @apply --chat-window-messages;
      }
      chat-input {
        @apply --chat-window-input;
      }
    </style>

    <div class="container">
      <slot name="chat-header"></slot>
      <chat-messages author="[[author]]" messages="[[messages]]"></chat-messages>
      <slot name="chat-footer"></slot>
      <slot name="chat-input"></slot>
      <template is="dom-if" if=[[!_hasCustomInput()]]>
		    <chat-input single-line=[[singleLine]]></chat-input>
      </template>
    </div>
  </template>

  <script>
    Polymer({

      is: 'chat-window',

      properties: {
        /**
         * Whether to allow single line messages only. This option has no effect
         * if using a custom input element.
         */
        singleLine: {
          type: Boolean,
          value: false
        },

        /**
         * The messages array. Each element must have three properties:
         * * `author`: The message's author
         * * `text`: The actual message
         * * `created`: The timestamp in millis the message was sent.
         */
        messages: {
          type: Array,
          value: function() { return []; }
        },

        /**
         * The author is compared to each message's author to determine how that
         * message should be displayed. If the message's author matches, the
         * default is to display it using flexbox's self-end alignment.
         */
        author: String
      },

      _hasCustomInput: function () {
        var distributed = Polymer.dom(this).childNodes;
				for (var i = 0; i < distributed.length; i++) {
          if (distributed[i].slot == 'chat-input') {
            return true;
          }
				}
        return false;
			}
    });
  </script>
</dom-module>
